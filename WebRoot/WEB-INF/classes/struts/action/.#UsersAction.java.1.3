/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package struts.action;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.actions.DispatchAction;

import entity.Users;

import server.UserServer;
import server.impl.UserServerImpl;
import struts.form.UsersForm;

/**
 * MyEclipse Struts Creation date: 06-23-2010
 * 
 * XDoclet definition:
 * 
 * @struts.action path="/users" name="usersForm" parameter="method"
 *                scope="request"
 */
public class UsersAction extends DispatchAction {
	/*
	 * Generated Methods
	 */

	/**
	 * Method execute
	 * 
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws IOException
	 */
	public ActionForward usersLogin(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
			throws IOException {
		UsersForm usersForm = (UsersForm) form;

		UserServer server = new UserServerImpl();

		Users users = server.userLogin(usersForm.getUname(), usersForm
				.getUpwd());
		if (users == null) {
			response.getWriter().print("<script>");
			response.getWriter().print("alert('用户名或密码不正确！');");
			response.getWriter().print("window.history.go(-1);");
			response.getWriter().print("</script>");
			return null;

		}

		request.getSession().setAttribute("users", users);

		return mapping.findForward("usok");
	}

	public ActionForward addUsers(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
			throws IOException {
		UsersForm usersForm = (UsersForm) form;

		PrintWriter out = response.getWriter();
		boolean flag = false;
		String uname = usersForm.getUname();
		String upwd = usersForm.getUpwd();
		String qr_pwd = usersForm.getUpwd();
		String email = usersForm.getEmail();
		String phone = usersForm.getPhone();

		UserServer userServer = new UserServerImpl();
		Users users = new Users();
		users.setUname(uname);
		users.setUpwd(qr_pwd);
		users.setEmail(email);
		users.setPhone(phone);
		users.setState(1);

		flag = userServer.add(users);
		if (flag = true) {

			out.print("<script>");
			out.print("alert('注册成功!!!');");
			out.print("window.location='userLogin.jsp';");

			out.print("</script>");
			return null;
		} else {

			out.print("<script>");
			out.print("alert('注册失败!!!');");
			out.print("window.location='userLogin.jsp';");
			out.print("</script>");
			return null;

		}

	}

	// 退出
	public ActionForward logout(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws IOException {
		 UsersForm usersForm = (UsersForm) form;
         request.getSession().setAttribute("users", null);
         if(usersForm.getFromto().equals("user")){
        	 return mapping.findForward("login");
         }else{
        	 return mapping.findForward("index");
         }
         
	
	}
}
